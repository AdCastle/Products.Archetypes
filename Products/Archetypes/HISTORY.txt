1.3.0-rc1 - unreleased
======================

 * Try to use BaseUnit for schema migration to keep the mimetype and the 
   filename of a BaseUnit based field. Without the changes the mimetype of 
   TextField got lost.
   This should fix [ 1001446 ] Content type lost in migration from pre 1.3b4 to
   1.3b4
   [tiran]

 * Changed portal type of ComplexType to keep it compatible with AT 1.2
   [tiran]

 * Fixed typo in Field.Field.getContentType
   [tiran]

 * Fixed Field.ImageField.rescaleOriginal to always return a binary string. This
   fixes the problem with original_size: [ 1004323 ] "IOError: cannot identify
   image file" when uploading image
   [tiran]
   
 * Fixed [ 1004510 ] folderlisting or plone_utils.browserDefault by adding an action
   'folderlisting' to folderish content types.
   [tiran]

 * Use True and False in favor to 1 and 0 to make the code more readable.
   [tiran]

 * Raise an error when trying to use an index on a reference field unless we
   have a good solution to avoid catalog corruption.
   [tiran]

 * Use edit accessor instead of the accessor in Schema.BasicSchema.validate().
   [alecacct]

 * Added a index_method property to Field.Field which may be either _at_accessor,
   _at_edit_accessor or the name of a method which is used as accessor for the
   index.
   [alecacct]

 * Starting from NOW all attributes starting with '_at_' are reserved for 
   internal usage. You MUST NEITHER add NOR access any attributes starting
   with '_at_' in your content types.
   [tiran]

 * Fixed  FTP/WebDAV's PUT in BaseObject:If a new object should be created with
   an id that can be acquired, then the existing object is silently overwritten
   rather than a new one created
   [dm]

 * Fixed with problem MKCOL/MKD used by FTP/WebDAV and 
   BaseFolde.manage_addFolder. Now MKCOL/MKD are creating a sub folder with the
   type name of the current folder except when this behavior is overwritten
   by an attribute called _at_type_subfolder.
   [dm]

 * Fixed [ 1006559 ] addReference allows adding garbage references. addReference
   is raising a ReferenceException when an invalid source or target was applied.
   [duncanb, tiran]

 * Fixed [ 1006491 ] File widget makes useless str(value) conversion
   [tiran, lurker]
   
 * Fixed possible issue inside ArchetypeTool.getWidgets() by calling
   initializeArchetype() on the wrapped dummy instance.
   [tiran]

 * Update catalog on reference catalog has raised a KeyError when trying to
   access an object that was already removed. Now ReferenceResolver is fetching
   the KeyError in resolve_url() and returns None instead.
   [tiran]

 * Added getRaw() method to LinesField which is returning the output of get().
   Before this change the edit accessor was using the accessor which might be an
   overwritten accessor. Thx to Joel Burton who has figured out the problem.
   [tiran]

 * Raise an ReferenceException inside Field.ReferenceField._Vocabulary when the
   brain doesn't have a valid uid.
   [tiran]

 * Refresh the uid catalog and reference catalog after migration.
   [tiran]

 * Don't commit full transactions inside migration. This may lead to database
   corruption.
   [tiran]

 * General cleanup of imports and public.py. Also include Marshallers in public.
   [tiran]

 * Fixed [ 1007850 ] Cancel content creation fails with portal factory tool
   Archetypes is playing nice again with portal factory
   [tiran]

1.3.0-beta5 - 2004-08-06
========================

 * Fixed forbidden access to schema methods when the schema was
   acccessed using archetype_tool.lookupType().
   [tiran]
   
 * Fixed typo in widgets/reference.pt
   [tiran]

 * Do not depend on plone's document_byline template which is
   not available in CMF.
   [ajung, tiran]
      
 * Applied patch from [ 997044 ] db_encoding parameter is lost
   in BaseSQLStorage.set
   [biza, tiran]
   
 * Updated complex type to make it work inside Plone again. It's very
   usefull to test fields and widgets.
   [tiran]

 * Applied [ 974846 ] Patch for bug #944343 inandout/picklist values
   not sticky to make picklist and inandout compatible with reference
   field again.
   [alecacct, tiran]

 * Reenabled Ben's reference graph tool by removing some stalled testing code
   [tiran]

 * Support unqualified references in reference graph tool
   [bcsaller]
   
 * Added a test for mimetypes registry before adapter call in BaseUnit.update()
   with a more verbose error in the case the user hasn't updated MTR properly.
   [tiran]

 * Fixed Find Objects of uid catalog and reference catalog: Use the relative 
   path (relative to the portal) of the object as uid instead of the full 
   physical path
   [tiran]

 * Added Rebuild Catalog tab to uid catalog and reference catalog to make the 
   life easier
   [tiran]

 * Added context to the PortalTransform.convertTo() call in BaseUnit.transform()
   [tiran]

 * Don't fail to install a product which doesn't have any types
   [spamsch]

 * Catch Unauthorized exception in ExtensibleMetadata.allowDiscussion that could
   be raised by the discussion tool when the authenticated users hasn't 
   ModifyPortalContent permissions.
   [tiran]

 * Added IUIDCatalog and IReferenceCatalog interface. Test for interfaces in
   the installation process of Archetypes to remove invalid catalogs.
   [tiran]

 * Added a check to Field._Vocabulary: A result from portal catalog must be a
   result from uid catalog, too.
   [ender]
   
 * FileField/ImageField: Make sure we always get a wrapped object in content_class
   [tiran]
   
 * ImageField: Fixed getScale/getSize methods, added tag() method
   [tiran]

 * session_save_form was using direct attr access in UT
   code you must use Schema accessor so schema has a 
   security context
   REMEMBER: <BradB> "Free as in Free Iraq"
   [runyaga]

 * issue a warning if they register 2 classes with the
   same name in the same project.  this will happen on
   startup.
   [runyaga]

 * do not assume templates have title_or_id attribute
   [runyaga]

 * Added kernel_make_uuid which is using /proc/sys/kernel/random/uuids as source
   for unique ids. Thx to Ben for this cool idea. :)
   The kernel uuid generator is actually a tiny bit slower than our uuid
   generator but it should be safer if you are worried about the uniqueness of
   uuids.
   [bcsaller, tiran]

 * Fixed [ 1002481 ] Missing i18n: <any>, added at_search_any msgid.
   [tiran]
   
1.3.0-beta4 - 2004-07-09
========================

 * Fix bug on image deletion [clebeaupin]

 * Fixed [ 997899 ] 1.3b3 will ot startup on Zope 2.7, Windows.
   Removed api helper to avoid problem with windows [dreamcatcher, tiran]

 * Small improvements on migration (using aq_base() instead of attribute, using
   is None test instead of simple bool test)
   [tiran]

 * Get the first non None object instead of the first element of a list of
   brains to circumvent problems with stalled objects inside the uid catalog
   [tiran]

 * Don't raise AttributeError when no reference can be found
   [gotcha]

 * Fixed a problem introduced by getRaw method on ReferenceField class.
   When using a field on 'hidden' mode, field.pt uses field.edit_acessor
   to get field value (and edit_accessor calls getRaw).
   The problem was related to ReferenceFields not multivalued where
   getRaw always returns a list, instead of the single UID.
   [deo]

 * Added a flag refresh_references to Archetypes.Extensions.utils.installTypes
   (default False). When enabled it's using ZopeFindAndApply to find all
   objects of the given types and refreshes their references. This is a 
   workaround but not a real fix for bug 997840.
   [tiran]

 * Added a test for at_version information
   [tiran]

 * Support Pdata (possible large data from OFS.Image) as type for FileField.
   This is required to load large images and files based on OFS.Image into a 
   FileField.
   [tiran]

 * Merged sid's security branch. DefaultLayer based classes (Field, Widget) and 
   schema are now subclassed from ExtensionsClass.Base.
   [dreamcatcher, tiran]

 * Fixed [ 994511 ] Field.py: Vocabulary cannot handle 2-tuple list
   [tiran]

 * Fixed creation_date field to be metadata again 
   [tiran]

 * Fixed [ 944440 ] getMsgID method of DisplayList should be used 
   [tiran]

 * Fixed [ 972091 ] base widget doesn't support visble attribute for view 
  [tiran]

 * Added better traceback information to fixAfterRenameType
   [tiran]

 * Fixed [ 988898 ] Don't swallow ConflictError (SQL missing)
   [tiran]
