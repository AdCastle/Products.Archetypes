<html xmlns="http://www.w3.org/1999/xhtml"
      xml:lang="en-US"
      lang="en-US"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      i18n:domain="plone">
  <head><title></title></head>
  <body>

    <div metal:define-macro="header">
      <h1 i18n:translate="heading_edit_item"
          metal:define-slot="title">
        Edit
        <span i18n:name="itemtype">
          <span i18n:translate=""
                tal:content="here/archetype_name"
          tal:omit-tag="">Item type</span>
        </span>
      </h1>

      <div tal:condition="fieldsets">
        <tal:block repeat="set fieldsets">
          <div tal:condition="python: set == fieldset and fieldsets != ['default']" tal:omit-tag="">
            <b>[<span tal:content="set" />]</b>
          </div>
          <div tal:condition="python: set != fieldset" tal:omit-tag="">
            <a href="#" tal:attributes="href string:${here/absolute_url}/base_edit?fieldset=${set}">
            [<span tal:content="set" />]</a>
          </div>
        </tal:block>
      </div>
      <metal:block define-slot="extra_info" />
    </div>

    <div metal:define-macro="body">
      <form name="edit_form"
            method="post"
            enctype="multipart/form-data"
            action=""
            tal:attributes="action python:here.absolute_url()+'/'+template.id">

        <fieldset>

          <legend
            i18n:translate=""
            tal:content="python:(len(fieldsets) > 1 and fieldset != 'default') and fieldset or here.archetype_name"
            />

          <!--
            <div tal:condition="errors" class="error">
            <div tal:repeat="error errors/keys">
            <strong tal:content="error">
            Field
            </strong>:<span tal:replace="python:errors[error]" />
            </div>
            </div>
            <pre tal:content="structure request/controller_state" />
            <pre tal:content="structure request" />
          -->

          <metal:block define-slot="extra_top" />

          <metal:block define-slot="widgets">
            <tal:fields repeat="field fields">
              <metal:fieldMacro use-macro="python: here.widget(field.getName(), mode='edit')" />
            </tal:fields>
          </metal:block>

          <metal:block define-slot="extra_bottom" />

          <input type="hidden" name="form.submitted" value="1" />
          <input type="hidden" name="add_reference.field:record" value="" />
          <input type="hidden" name="add_reference.type:record" value="" />

          <tal:env define="env request/controller_state/kwargs">
            <tal:loop repeat="varname python:(
                      'reference_source_url',
                      'reference_source_field',
                      'reference_source_fieldset')">
              <tal:reference define="items python:env.get(varname, request.get(varname))"
                             condition="items">
                <input tal:repeat="item items"
                       type="hidden"
                       name="form_env.reference_source_url:list:record"
                       value="value"
                       tal:attributes="value item;
                       name string:form_env.${varname}:list:record"
                       />
              </tal:reference>
            </tal:loop>
          </tal:env>

          <tal:comment replace="nothing">
            Turn 'persistent_' variables from controller_state persistent
          </tal:comment>
          <tal:env repeat="env request/controller_state/kwargs/items">
            <input type="hidden" name="key"
                   value="value"
                   tal:define="key python:env[0];
                   value python:env[1]"
                   tal:condition="python:key.startswith('persistent_')"
                   tal:attributes="name string:form_env.${key}:record;
                   value value"
                   />
          </tal:env>

          <tal:comment replace="nothing">
            Turn 'persistent_' variables from forms (GET/POST) persistent
          </tal:comment>
          <tal:env repeat="env request/form">
            <input type="hidden" name="key"
                   value="value"
                   tal:define="key env;
                   value request/?env"
                   tal:condition="python:key.startswith('persistent_')"
                   tal:attributes="name string:form_env.${key}:record;
                   value value"
                   />
          </tal:env>

          <input type="hidden" name="fieldset"
                 value="default" tal:attributes="value fieldset"
                 />

          <metal:block define-slot="buttons">
            <div class="field"
                 tal:define="fieldset_index python:fieldsets.index(fieldset);
                 n_fieldsets python:len(fieldsets);">
              <label>&nbsp;</label>
              <input tal:condition="python:fieldset_index > 0"
                     class="context"
                     tabindex=""
                     type="submit"
                     name="form_previous"
                     i18n:attributes="value"
                     value="Previous"
                     tal:attributes="tabindex tabindex/next;"
                     />
              <input tal:condition="python:fieldset_index &lt; n_fieldsets-1"
                     class="context"
                     tabindex=""
                     type="submit"
                     name="form_next"
                     i18n:attributes="value"
                     value="Next"
                     tal:attributes="tabindex tabindex/next;"
                     />
              <input class="context"
                     tabindex=""
                     type="submit"
                     name="form_submit"
                     i18n:attributes="value"
                     value="Finish"
                     tal:attributes="tabindex tabindex/next;"
                     />
            </div>
          </metal:block>

          <metal:block define-slot="extra_buttons" />

        </fieldset>
      </form>
    </div>

    <metal:footer_macro define-macro="footer" />

  </body>
</html>