<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      i18n:domain="plone">
  <head><title></title></head>
  <body>

    <metal:define define-macro="image_display">
        <div class="field"
             tal:define="img accessor; 
                         inline python: img and
                              (img.getSize() &lt;= widget.display_threshold) and
                              (request.get('HTTP_ACCEPT', '').find(img.getContentType()) &gt;= 0)"
             tal:condition="inline">
            <metal:block define-slot="widget_label">
            </metal:block>
            <img tal:replace="structure img/tag"
                 src="foo.png"
                 alt="image" />
        </div>
    </metal:define>


    <!-- Image Widgets -->
    <metal:define define-macro="view">
      <metal:display use-macro="here/widgets/image/macros/image_display" />
      <metal:file use-macro="here/widgets/file/macros/file_view">download link</metal:file>
    </metal:define>

    <metal:define define-macro="edit">
      <metal:use use-macro="field_macro | here/widgets/field/macros/edit">
        <metal:fill fill-slot="widget_body">
          <div>
            <metal:display use-macro="here/widgets/image/macros/image_display">
              <br />
	        </metal:display>
	      </div>
	      <metal:block metal:use-macro="here/widgets/file/macros/file_view"/>
          <div tal:condition="python: accessor() and not field.required">
            <input class="noborder"
                   type="checkbox"
                   value="on"
                   tabindex=""
                   tal:attributes="tabindex tabindex/next;
                       name string:${fieldName}_delete;
                       id string:${fieldName}_checkbox;
                       checked python:str(value) == '1';"
		     />
            <span i18n:translate="delete_image">delete image</span>
          </div>
          <div>
            <input type="file"
                   size="30"
                   tabindex=""
                   tal:attributes="name string:${fieldName}_file;
                                   tabindex tabindex/next;"
            />
          </div>
	    </metal:fill>
      </metal:use>
    </metal:define>

    <div metal:define-macro="search">
      <div metal:use-macro="here/widgets/image/macros/edit">
      </div>
    </div>

  </body>

</html>

