<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      i18n:domain="plone">

<body>

<!-- Keyword Widgets -->

    <div class="field" metal:define-macro="view">
     <metal:block define-slot="widget_label">
     </metal:block>
     <metal:block use-macro="here/widgets/field/macros/view">
	<metal:block fill-slot="widget_view">
	  <tal:block repeat="item accessor">
	    <span tal:content="item"/><br/>
	  </tal:block>
	</metal:block>
      </metal:block>
    </div>

    <div metal:define-macro="edit">
      <div tal:attributes="class python:test(field.required, 'required label', 'label')">
	<span i18n:translate="" tal:content="python:widget.Label(here)"/>
	<div class="field"
            tal:define="error errors/fieldName | nothing;
	    accessor_name field/accessor;
            value python:request.get(fieldName, None);
	    value python:value and [value] or accessor()"
	    tal:attributes="class python:test(error, 'field error', 'field')" >
	    <span tal:condition="error" tal:replace="error" />

	      <script language="JavaScript">
		function addSelectedKeywords(fieldName) {
		predefKeywords=document.getElementById(fieldName + '_predefined_keywords');
		for (var x=0; x<predefKeywords.length; x++) {
		  if (predefKeywords[x].selected) {
		      addNewKeyword(fieldName, predefKeywords[x].value);
		      }
		    }
		  }

		  function addNewKeyword(fieldName, newWord) {
		      selKeywords=document.getElementById(fieldName + '_entered_keywords');
		      if (selKeywords) {
		        selKeywords.value+= newWord + '\n';
		      } else {
		        selKeywords.value = newWord + '\n';
		      }
		  }
	      </script>

	    <table>
	      <tr><td>
		  Existing <span tal:content="fieldName"/>
		  <br />
		      <select size="7"
			      multiple="multiple"
			      tal:attributes="
			      id string:${fieldName}_predefined_keywords;
			      name string:${fieldName}_predefined_keywords;
			      tabindex tabindex/next;">
                        <option value="#" tal:define="keywords python: here.collectKeywords(fieldName, accessor_name)"
			tal:repeat="keyword keywords"
			tal:content="keyword" tal:attributes="value python: keywords.getValue(keyword)"> # </option>
                        </select>

                        <br />

                        <input class="context"
                               type="submit"
                               name="add"
                               tabindex=""
                               value="Add Selected &gt;"
                               tal:attributes="
			onclick string: javascript: addSelectedKeywords('${fieldName}');;return false;
			tabindex tabindex/next;">

                    <br />
		    <div tal:define="fixed python: test(field.enforceVocabulary == 1, 1, 0);"
                         tal:condition="python: test(fixed, 0, 1)">
                    New keyword <br />
                    <input type="text"
                           value=""
                           size="20"
                           tabindex=""
                           tal:attributes="
			    name string:${fieldName}_entered_keyword;
			    tabindex tabindex/next;"
                           />
                    <br />
                    <input class="context"
                           type="submit"
                           name="add"
                           tabindex=""
                           value="Add New &gt;"
                           tal:attributes="
			  onclick string: javascript:addNewKeyword('$fieldName', document.edit_form.${fieldName}_entered_keyword.value);;return false;
			  tabindex tabindex/next;"
                           />
                    </div>
                    </td>

                    <td>
                    Selected <span tal:content="fieldName"/><br />
                    <textarea
			      rows="15"
			      cols="15"
			      wrap="off"
			      tabindex=""
			      tal:attributes="name fieldName;
		  id string:${fieldName}_entered_keywords;
		  tabindex tabindex/next;"
	      ><span tal:omit-tag="" tal:repeat="item value" tal:replace="python: item +'\n'"/></textarea>&nbsp;
	</td></tr>
      </table>
      </div>
    </div>
  </div>

    <div metal:define-macro="search">
      <div metal:use-macro="here/widgets/keyword/macros/edit">
      </div>
    </div>

  </body>

</html>

