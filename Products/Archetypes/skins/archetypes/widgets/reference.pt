<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      i18n:domain="plone">
    <body>
        <!-- Reference Widgets -->

        <div class="field"
             metal:define-macro="view">
            <metal:block define-slot="widget_label"></metal:block>
            <metal:block use-macro="here/widgets/field/macros/view">
                <metal:block fill-slot="widget_view">
                    <a href="#"
                       tal:define="obj python:here.reference_catalog.lookupObject(uuid = accessor());"
                       tal:attributes="href obj/absolute_url"
                       tal:content="python:obj.Title() or obj.absolute_url(relative=1)"
                       tal:condition="python:not field.multiValued and obj is not None"></a>
                    <tal:block tal:condition="python:field.multiValued"
                               tal:repeat="obj python:[here.reference_catalog.lookupObject(uuid = uid) for uid in (accessor() or [])]">
                        <a href="#"
                           tal:attributes="href obj/absolute_url"
                           tal:content="python:obj.Title() or obj.absolute_url(relative=1)"
                           tal:condition="python:obj is not None"></a>
                    </tal:block>
                </metal:block>
            </metal:block>
        </div>

        <div metal:define-macro="edit">
            <div metal:use-macro="here/widgets/field/macros/edit">
                <div metal:fill-slot="widget_body"
                     tal:define=" vocab python:field.Vocabulary(here); 
                                  fieldName python:test(field.multiValued,fieldName+':list',fieldName); 
                                  vlen python: len(vocab);">
                    <input type="hidden"
                           value=""
                           tal:condition="python: (not field.required) and field.multiValued"
                           tal:attributes="name string:$fieldName:default:list" />
                    <select tal:attributes="name fieldName; 
                                            id fieldName; 
                                            multiple python:test(field.multiValued,'multiple',''); 
                                            tabindex tabindex/next;">
                        <option selected="selected"
                                tal:repeat="item vocab"
                                tal:attributes="selected python:test(field.containsValueAsString(item,value), 'selected', None); 
                                                value item;"
                                tal:content="python: vocab.getValue(item)"></option>
                    </select>

                    <!-- handle "addable" option -->
                    <div tal:condition="field/addable|nothing">
                        <span tal:repeat="addable field/allowed_types"
                              tal:omit-tag="">
                            <a href="#"
                               tal:define="create string:createObject?type_name=${addable}; 
                                           dest python:test(field.destination, '%s%s' % (portal_url, field.destination), container.absolute_url())"
                               tal:attributes="href string:${dest}/${create}"
                               tal:content="string:Add New ${addable}">
                                Add new foo
                            </a>
                        </span>
                    </div>

                </div>
            </div>
        </div>

        <div metal:define-macro="search">
            <div metal:use-macro="here/widgets/reference/macros/edit"></div>
        </div>

    </body>
</html>
